<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Nahwu Sorof</title>
    
    <link rel="stylesheet" href="style.css">
    
    <style>
        .menu-icon { font-size: 30px; cursor: pointer; color: white; }
    </style>
</head>

<body class="dashboard-body">

    <nav class="navbar">
        <div class="nav-left">
            <span class="menu-icon" onclick="toggleSidebar()">&#9776;</span> 
        </div>
        <div class="nav-right">
            <div class="profile-circle-small">
                  <img src="logo.jpeg" alt="Logo">
            </div>
        </div>
    </nav>

    <div id="mySidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="profile-circle-large">
                      <img src="profil.png" alt="Profil Pengguna">
            </div>
            <h3>&lt;nama&gt;</h3>
        </div>
        
        <a href="#" class="logout-btn">log out</a>
    </div>

    <div id="overlay" onclick="toggleSidebar()"></div>

    <div class="dashboard-content">
        
        <h1 class="page-title">pembelajaran nahwu dan sorof</h1>

        <div class="cards-container">     
            <div class="card user-card">
                <div class="card-header-row">
                    <div class="profile-circle-medium">
                      <img src="profil.png" alt="Profil Pengguna">
                    </div>
                    <h3>&lt;nama&gt;</h3>
                </div>

                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="progress-container">
                        <div class="progress-bar" style="width: 0%;"></div>
                    </div>
                    <span class="progress-text">0 %</span>
                </div>

                <div class="button-row">
                    <button class="action-btn" onclick="location.href='materi.html'">Materi</button>
                    <button class="action-btn" onclick="location.href='soal.html'">Soal</button>
                    <button class="action-btn" onclick="location.href='https://trakteer.id/jkt48'">Traktir</button>
                </div>
            </div> 
        </div>

        <div style="text-align: center;">
            <button onclick="location.href= 'game4.html'" style="margin:15px; padding:10px 20px; background:#6a90aa; color:white; border:none; border-radius:10px; cursor:pointer; font-size:16px;">Mini Game ðŸŽ®</button>
        </div>
    </div>

    <script>

        function userKey(key) {
    const user = localStorage.getItem("namaUser");
    return `${user}_${key}`;
}

        // 1. Fungsi Buka/Tutup Sidebar
        function toggleSidebar() {
            var sidebar = document.getElementById("mySidebar");
            var overlay = document.getElementById("overlay");
            sidebar.classList.toggle("active");
            overlay.classList.toggle("active");
        }

        // 2. Fungsi Otomatis saat Halaman Dibuka
       window.onload = function () {

    const activeUser = localStorage.getItem("namaUser");

    // â›” belum login
    if (!activeUser) {
        alert("Eits, kamu belum login!");
        window.location.href = "index.html";
        return;
    }

    // ganti <nama>
    document.querySelectorAll("h3").forEach(el => {
        if (el.innerText.includes("nama")) {
            el.innerText = activeUser;
        }
    });

    // hitung progress PER AKUN
    const TOTAL_MATERI = 9;

    const done = JSON.parse(
        localStorage.getItem(userKey("materiDone"))
    ) || [];

    const percent = Math.round((done.length / TOTAL_MATERI) * 100);

    document.querySelectorAll(".progress-bar").forEach(bar => {
        bar.style.width = percent + "%";
    });

    document.querySelectorAll(".progress-text").forEach(text => {
        text.innerText = percent + " %";
    });
};


            // CEK KEAMANAN: Kalau belum login, usir balik ke index!
            if (!activeUser) {
                alert("Eits, kamu belum login!");
                window.location.href = 'index.html';
                return;
            }

            // UPDATE NAMA: Cari semua tulisan <nama> dan ganti
            const allHeadings = document.querySelectorAll('h3');
            allHeadings.forEach(el => {
                // Cek apakah isinya "<nama>"
                if (el.innerText.includes('<nama>') || el.innerText.includes('&lt;nama&gt;')) {
                    el.innerText = activeUser;
                }
            });

            // UPDATE PROGRESS BAR: Set lebar dan tulisan %
            const bars = document.querySelectorAll('.progress-bar');
            const texts = document.querySelectorAll('.progress-text');

            bars.forEach(bar => {
                bar.style.width = currentProgress + '%';
            });

            texts.forEach(text => {
                text.innerText = currentProgress + ' %';
            });
        };

        // 3. Fungsi Logout
        const logoutBtn = document.querySelector('.logout-btn');
logoutBtn.addEventListener('click', function (e) {
    e.preventDefault();

    // hapus user aktif saja
    localStorage.removeItem("namaUser");

    window.location.href = "index.html";
});

    </script>

</body>

</html>

